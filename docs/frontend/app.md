# üé® –§—Ä–æ–Ω—Ç–µ–Ω–¥: `app.js`

–§–∞–π–ª `app.js` ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å API.  
–û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã, –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞ –∏ —Ä–∞–±–æ—Ç—É —Å –∫–∞—Ä—Ç–æ–π (—á–µ—Ä–µ–∑ Leaflet).

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç:
- –∏–Ω—Ç–µ—Ä–µ—Å—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é),
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∞—Å–æ–≤,
- —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é.

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ¬´–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç¬ª:
- –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç `payload`;
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å `POST /api/itinerary`;
- –æ—Ç–≤–µ—Ç —Å –º–∞—Ä—à—Ä—É—Ç–æ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

```js
async function fetchItinerary(payload) {
  const response = await fetch("/api/itinerary", { ... });
  return response.json();
}
```

---

### 2. –û—á–∏—Å—Ç–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
```js
function sanitizeInterestInput(raw) {
  return raw.split(",").map((chunk) => chunk.trim()).filter(Boolean);
}
```
–†–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ –∑–∞–ø—è—Ç—ã–º –∏ —É–±–∏—Ä–∞–µ—Ç –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

---

### 3. –†–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–æ–π
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Leaflet.js**:
- –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–∞—Ä—Ç–∞ (`ensureMap`);
- –Ω–∞ –Ω–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –º–µ—Ç–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –º–∞—Ä—à—Ä—É—Ç–∞ (`renderMap`);
- –∫–∞—Ä—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –≤—Å–µ —Ç–æ—á–∫–∏ (`fitBounds`).

```js
function renderMap(stops) {
  markersLayer.clearLayers();
  stops.forEach((stop, index) => { ... });
  mapInstance.fitBounds(bounds, { padding: [30, 30] });
}
```

---

### 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
–§—É–Ω–∫—Ü–∏—è `renderItinerary(data)` –≤—ã–≤–æ–¥–∏—Ç:
- –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (`summary`);
- —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ (`stopsList`);
- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (`notesList`);
- –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç—É.

```js
function renderItinerary(data) {
  summaryNode.textContent = `${data.summary}...`;
  data.stops.forEach((stop, index) => { ... });
  renderMap(data.stops);
}
```

---

### 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
–ü–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –µ–≥–æ –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.  
–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ:

```js
feedbackForm.addEventListener("submit", async (event) => {
  const payload = {
    rating,
    comment,
    interests,
    location,
    available_hours,
    stops,
  };
  await fetch("/api/feedback", { method: "POST", body: JSON.stringify(payload) });
});
```

---

## üß† –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------------|------------|
| `form` | –§–æ—Ä–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä—à—Ä—É—Ç–∞ |
| `summaryNode` | –ë–ª–æ–∫ –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ |
| `stopsList` | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–ø–∏—Å–∫–æ–º –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ |
| `notesList` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |
| `mapNode` | –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç—ã |
| `feedbackForm` | –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∑—ã–≤–∞ |
| `mapInstance`, `markersLayer` | –û–±—ä–µ–∫—Ç—ã Leaflet |
| `lastItineraryContext` | –•—Ä–∞–Ω–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∏–¥–±—ç–∫–∞ |

---

## üó∫Ô∏è –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É ‚Üí POST /api/itinerary ‚Üí –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ + –∫–∞—Ä—Ç–∞
                                               ‚Üì
                                        POST /api/feedback
                                               ‚Üì
                                       –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
```

---

## üí° –ò—Ç–æ–≥
`app.js` —Å–æ–µ–¥–∏–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å API:
- —Å–æ–±–∏—Ä–∞–µ—Ç –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
- –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç —É –±—ç–∫–µ–Ω–¥–∞,
- –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã,
- –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –ø–æ—Å–ª–µ –ø–æ–µ–∑–¥–∫–∏.
